{{ if and (.Values.keda.enabled) (.Capabilities.APIVersions.Has "keda.sh/v1alpha1") }}
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: {{ include "openvidu.fullname" . }}-master-to-zero
spec:
  cooldownPeriod: {{ .Values.keda.coolDown }}
  maxReplicaCount: {{ .Values.services.openvidu.pro.masterReplicas }}
  minReplicaCount: {{ .Values.keda.cron.desiredReplicas }}
  pollingInterval: {{ .Values.keda.interval }}
  scaleTargetRef:
    apiVersion: apps/v1
    kind: StatefulSet
    name: {{ include "openvidu.fullname" . }}-master
  triggers:
  - metadata:
      desiredReplicas: "{{ .Values.keda.cron.desiredReplicas }}"
      start: {{ .Values.keda.cron.start }}
      end: {{ .Values.keda.cron.end }}
      timezone: {{ .Values.keda.cron.timeZone }}
    type: cron
---
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: {{ include "openvidu.fullname" . }}-media-to-zero
spec:
  cooldownPeriod: {{ .Values.keda.coolDown }}
  maxReplicaCount: {{ .Values.services.openvidu.pro.mediaNodeReplicas }}
  minReplicaCount: {{ .Values.keda.cron.desiredReplicas }}
  pollingInterval: {{ .Values.keda.interval }}
  scaleTargetRef:
    apiVersion: apps/v1
    kind: StatefulSet
    name: {{ include "openvidu.fullname" . }}-media-node
  triggers:
  - metadata:
      desiredReplicas: "{{ .Values.keda.cron.desiredReplicas }}"
      start: {{ .Values.keda.cron.start }}
      end: {{ .Values.keda.cron.end }}
      timezone: {{ .Values.keda.cron.timeZone }}
    type: cron    
{{ end }}